---
title: "Visit Scotland Notebook"
output: html_notebook
---

## Load Libraries

```{r}
library(tidyverse)
library(here)
library(sf)
library(infer)
```

## Run Cleaning Script

```{r}
source(here("scripts/cleaning_script.R"))
```

## Read In Clean Data

```{r}

regional_domestic_tourism_all <- read_csv(here("data/clean_data/regional_domestic_tourism_all_clean.csv"))
regional_domestic_tourism_individual <- read_csv(here("data/clean_data/regional_domestic_tourism_individual_clean.csv"))
local_authority_geo <- st_read(dsn = "data/geo_data/", layer = "pub_las")

```

## Trends Over Time

### Domestic Tourism / Visits

```{r}

regional_domestic_tourism_all %>%
  ggplot(aes(x = date_code, y = visits)) +
  geom_line(group = 1) +
  geom_point(aes(colour = visits_change_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year Range",
       y = "Visitors (Thousands) \n",
       title = "Average Annual Number of Domestic Vistors",
       subtitle = "3 Year Average")

```

### Domestic Tourism / Expenditure

```{r}

regional_domestic_tourism_all %>%
  ggplot(aes(x = date_code, y = expenditure)) +
  geom_line(group = 1) +
  geom_point(aes(colour = exp_change_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year Range",
       y = "Expenditure (Million GBP) \n",
       title = "Average Annual Expenditure of Domestic Vistors",
       subtitle = "3 Year Average")

```
### Domestic Tourism / Nights Stayed

```{r}

regional_domestic_tourism_all %>%
  ggplot(aes(x = date_code, y = nights)) +
  geom_line(group = 1) +
  geom_point(aes(colour = nights_change_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year Range",
       y = "Nights (Thousands) \n",
       title = "Average Annual Nights Stayed by Domestic Vistors",
       subtitle = "3 Year Average")

```

### Domestic Tourism / Expenditure per Visit

```{r}
regional_domestic_tourism_all %>%
  ggplot(aes(x = date_code, y = exp_per_visit)) +
  geom_line(group = 1) +
  geom_point(aes(colour = exp_per_visit_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year Range",
       y = "3x Year Average Expenditure per Visit (Thousands) \n",
       title = "Average Expenditure Per Visit Domestic Vistors",
       subtitle = "3 Year Average")
```

## Domestic Tourism

#### Average Visits By Region

##### Over Time

```{r}
regional_domestic_tourism_individual %>%
  filter(visits > 1000) %>% 
  ggplot() +
  geom_line(aes(x = year, y = visits, colour = local_authority, group = local_authority))
```

##### Stats

```{r}

regional_domestic_tourism_all %>% 
  summarise(mean_annual_visits = mean(visits))

regional_domestic_tourism_all %>%
  rep_sample_n(size = 12, replace = TRUE, reps = 5000) %>%
  summarise(mean_visits = mean(visits)) %>% 
  get_confidence_interval(level = 0.95, type = "percentile")

```

##### Map

```{r}

regional_data_joined %>% 
  group_by(code) %>% 
  summarise(mean_visits = mean(visits)) %>% 
  ggplot(aes(fill = mean_visits)) + 
  geom_sf() +
  labs(
    x = "Longitude",
    y = "Latitude",
    title = "Average Annual Number of Domestic Vistors",
    subtitle = "By Region",
    fill = "Visits (Thousands)"
  ) +
  theme(panel.background = element_rect(fill = "white"))

```

#### Expenditure by Region

##### Over Time

```{r}
regional_domestic_tourism_individual %>%
  filter(expenditure > 300) %>% 
  ggplot() +
  geom_line(aes(x = year, y = expenditure, colour = local_authority, group = local_authority))
```

##### Stats

```{r}
regional_domestic_tourism_all %>% 
  summarise(mean_annual_exp = mean(expenditure))

regional_domestic_tourism_all %>%
  rep_sample_n(size = 12, replace = TRUE, reps = 5000) %>%
  summarise(mean_annual_exp = mean(expenditure)) %>% 
  get_confidence_interval(level = 0.95, type = "percentile")

```

##### Map

```{r}
regional_data_joined %>% 
  group_by(code) %>% 
  summarise(mean_exp = mean(expenditure)) %>% 
  ggplot(aes(fill = mean_exp)) + 
  geom_sf() +
  labs(
    x = "Longitude",
    y = "Latitude",
    title = "Average Annual Expenditure of Domestic Vistors",
    subtitle = "By Region",
    fill = "Expenditure (Million GBP)"
  ) +
  theme(panel.background = element_rect(fill = "white"))
```

#### Spend Per Visit

```{r}
regional_domestic_tourism_individual %>%
  filter(visits != 0,
         expenditure != 0) %>% 
  mutate(exp_per_visit = expenditure / visits, rm.na = TRUE) %>%
  group_by(local_authority) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  arrange(desc(mean_exp_per_visit)) %>%
  ggplot() +
  geom_col(aes(x = reorder(local_authority, mean_exp_per_visit), y = mean_exp_per_visit,
               fill = local_authority %in% c("City of Edinburgh", "Glasgow City", "Highland")),
           show.legend = FALSE, colour = "white") +
  scale_fill_manual(values = c("FALSE" = "grey60",
                               "TRUE" = "#540453")) +
  coord_flip() +
  labs(
    x = "Region",
    y = "Mean Expenditure per Visit (Million GBP / Thousand Visits)",
    title = "Domestic Tourism Mean Expenditure per Visit",
    subtitle = "By Region")
```

## International Tourism

### Visit Stats

```{r}
international_visits %>%
  filter(year %in% c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019)) %>% 
  group_by(year) %>% 
  summarise(sum_annual_visits = sum(visits)) %>% 
  summarise(avg_annual_visits = mean(sum_annual_visits))

international_visits_summary <- international_visits %>%
  filter(year %in% c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019)) %>%
  group_by(year) %>% 
  summarise(sum_annual_visits = sum(visits))

international_visits_summary %>%
  rep_sample_n(size = 11, replace = TRUE, reps = 5000) %>%
  summarise(mean_visits = mean(sum_annual_visits)) %>% 
  get_confidence_interval(level = 0.95, type = "percentile")

```

### Expenditure Stats

```{r}
international_visits %>%
  filter(year %in% c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019)) %>%
  group_by(year) %>% 
  summarise(sum_annual_exp = sum(spend)) %>% 
  summarise(avg_annual_spend = mean(sum_annual_exp))

international_spend_summary <- international_visits %>%
  filter(year %in% c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019)) %>% 
  group_by(year) %>% 
  summarise(sum_annual_exp = sum(spend))

international_spend_summary %>%
  rep_sample_n(size = 11, replace = TRUE, reps = 5000) %>%
  summarise(mean_spend = mean(sum_annual_exp)) %>% 
  get_confidence_interval(level = 0.95, type = "percentile")

```

### Visitor Country of Residence

```{r}
international_visits %>% 
  select(-c(quarter, age, sample)) %>%
  filter(year %in% c(c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019))) %>% 
  group_by(year, country) %>% 
  summarise(total_spend = sum(spend)) %>% 
  ggplot(aes(x = year, y = total_spend, colour = country)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019)) +
  labs(x = "\n Year",
       y = "Expenditure (Million) \n",
       title = "Expenditure by Country",
       subtitle = "Top 5 Countries per Total Expenditure")
```


