---
title: "Draft Work Notebook"
output: html_notebook
---


```{r}
regional_domestic_tourism %>%
  filter(feature_code != "S92000003",
         region_of_residence == "All of GB") %>%
  arrange(date_code) %>% 
  select(-c(measurement, units)) %>% 
  pivot_wider(names_from = breakdown_of_domestic_tourism, values_from = value) %>% 
  clean_names() %>%
  rename(year = date_code) %>% 
  inner_join(local_authority_codes, by = "feature_code")

```



## Load Libraries

```{r}
library(tidyverse)
library(here)
library(modelr)
library(ggfortify)
```

## Run Cleaning Script

```{r}
source(here("scripts/cleaning_script.R"))
```

## Read In Clean Data

```{r}

demographics_all <- read_csv(here("data/clean_data/all_demographics_clean.csv"))
employment_demographics <- read_csv(here("data/clean_data/employment_demographics_clean.csv"))
gender_demographics <- read_csv(here("data/clean_data/gender_demographics_clean.csv"))
age_demographics <- read_csv(here("data/clean_data/age_demographics_clean.csv"))
marital_demographics <- read_csv(here("data/clean_data/marital_status_demographics_clean.csv"))
children_demographics <- read_csv(here("data/clean_data/children_demographics_clean.csv"))
car_demographics <- read_csv(here("data/clean_data/car_demographics_clean.csv"))
social_demographics <- read_csv(here("data/clean_data/social_demographics_clean.csv"))
regional_domestic_tourism_all <- read_csv(here("data/clean_data/regional_domestic_tourism_all_clean.csv"))
activities <- read_csv(here("data/clean_data/activities_clean.csv"))
usa_visit_spend_region <- read_csv(here("data/clean_data/usa_visit_spend_region_clean.csv"))

```

## Temporal Analysis

### Total Visits Over Time

```{r}

# Total Visits Over Time

demographics_all %>% 
  ggplot(aes(x = year, y = visits, group = 1)) +
  geom_line(size = 1.5, colour = "grey") +
  geom_point(aes(colour = visits_change_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year",
       y = "No. of Day Visits (Million) \n",
       title = "Annual Number of Day Visits") +
  scale_y_continuous(limits = c(0, 200), breaks = c(0, 100, 200)) +
  scale_x_continuous(breaks = c(2013, 2014, 2015, 2016, 2017, 2018, 2019)) +
  theme(plot.title = element_text(size = 20, face = "bold"),
        plot.subtitle = element_text(size = 10),
        panel.background = element_rect(fill = "white"),
        panel.grid = element_line(colour = "grey90", 
                                  linetype = "dashed"))
```

### Total Expenditure Over Time

```{r}

# Total Expenditure Over Time

demographics_all %>% 
  ggplot(aes(x = year, y = expenditure, group = 1)) +
  geom_line(size = 1, colour = "grey") +
  geom_point(aes(colour = exp_change_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year",
       y = "Expenditure (Million Pounds, GBP) \n",
       title = "Expenditure Over Time") +
  scale_y_continuous(limits = c(0, 6500), breaks = c(0, 2000, 4000, 6000)) +
  scale_x_continuous(breaks = c(2013, 2014, 2015, 2016, 2017, 2018, 2019))

```
### Expenditure Per Visit Over Time

```{r}

# Expenditure Per Visit Over Time

demographics_all %>% 
  ggplot(aes(x = year, y = exp_per_visit, group = 1)) +
  geom_line(size = 1, colour = "grey") +
  geom_point(aes(colour = exp_per_visit_label), 
             show.legend = FALSE,
             size = 4) +
  labs(x = "\n Year",
       y = "Expenditure (Million Pounds, GBP) per Visit (Millions) \n",
       title = "Expenditure Per Visit \n") +
  scale_y_continuous(limits = c(0, 60), breaks = c(0, 20, 40, 60)) +
  scale_x_continuous(breaks = c(2013, 2014, 2015, 2016, 2017, 2018, 2019))

```

## Demographic Analysis

- Highest Mean Spend Per Visit (2013-2018) vs. 2019
- Highest Mean Spend Per Visit.

### Age

Spend Per Visit Over Period: 45-54
Spend Per Visit (2013-2018) vs. 2019: 
- Increase in 25-34, 35-44, 55-64, 65+
- Interesting decrease in 45-54 despite being highest mean across all years.

Conclusion: May suggest that there is scope for growth in other age groups, but not in 45-54.

```{r}
age_demographics %>%
  group_by(age) %>% 
  summarise(mean_visits = mean(visits)) %>% 
  arrange(age) %>% 
  ggplot() +
  geom_col(aes(x = age, y = mean_visits, fill = age == "16-24 years"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Age",
    y = "Mean Visits per Year (Million) \n",
    title = "Mean Visits 2013-2019") +
  coord_flip()
```

```{r}
age_demographics %>%
  group_by(age) %>% 
  summarise(mean_exp = mean(expenditure)) %>% 
  arrange(age) %>% 
  ggplot() +
  geom_col(aes(x = age, y = mean_exp, fill = age == "25-34 years"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Age",
    y = "Mean Visits per Year (Million) \n",
    title = "Mean Visits 2013-2019") +
  coord_flip()
```


```{r}
age_demographics %>%
  group_by(age) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = age, y = mean_exp_per_visit, fill = age == "45-54 years"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Age",
    y = "Mean Annual Expenditure \n",
    title = "Mean Annual Expenditure 2013-2019") +
  coord_flip()
```

```{r}

age_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(age, is_2019) %>%
  arrange(age) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = reorder(age, difference_exp_per_visit), y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Age",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))

```

### Gender

Highest Mean Spend Per Visit Over Period: Little difference between male and female spend per visit.
Mean Spend Per Visit (2013-2018) vs. 2019: Both Increased.

Conclusion: Little difference between genders, both show potential for growth.

```{r}
gender_demographics %>%
  group_by(gender) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = gender, y = mean_exp_per_visit, fill = gender == "Male"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Gender",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019")
```


```{r}
gender_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(gender, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = gender, y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Gender",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```


### Marital Status

Highest Mean Spend Per Visit Over Period: Married people spend more than un-married.
Mean Spend Per Visit (2013-2018) vs. 2019: Both Increased.

Conclusion: Although married people were already spending the most per visit, their spend increased by a larger amount in 2019 than un-married people, suggesting there is still plenty of room for growth.

```{r}
marital_demographics %>%
  group_by(marital_status) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = marital_status, y = mean_exp_per_visit, fill = marital_status == "Married"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Marital Status",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019",
    subtitle = "By Marital Status")
```


```{r}
marital_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(marital_status, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = marital_status, y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Marital Status",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```

### Children

Highest Mean Spend Per Visit Over Period: People with children spent more per visit than people without.
Mean Spend Per Visit (2013-2018) vs. 2019: Both Increased.

Conclusion: Although people with children spend more per visit than people without, both categories increased spending per visit in 2019 suggesting there is room for growth in both areas.

```{r}
children_demographics %>%
  group_by(children) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = children, y = mean_exp_per_visit, fill = children == "Yes - Children"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Children",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019",
    subtitle = "By Children")
```

```{r}
children_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(children, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = children, y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Children",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```

### Employment

Highest Mean Spend Per Visit Over Period: People in employment have the highest average spend per visit.
Mean Spend Per Visit (2013-2018) vs. 2019: All Increased.

Conclusion: Although people in employment have the highest spend per visit there was rleatively little growth in this area in 2019. By comparison both other categories increase their spend per visit suggesting theire is potential for growth in these areas.

```{r}
employment_demographics %>%
  group_by(employment_status) %>% 
  summarise(mean_exp = mean(expenditure)) %>% 
  ggplot() +
  geom_col(aes(x = employment_status, y = mean_exp, fill = employment_status == "Employed/self-employed (full or part time)"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Employment",
    y = "Mean Annual Spend \n",
    title = "Mean Annual Spend 2013-2019") +
  coord_flip()
```


```{r}
employment_demographics %>%
  group_by(employment_status) %>% 
  summarise(mean_visits = mean(visits)) %>% 
  ggplot() +
  geom_col(aes(x = employment_status, y = mean_visits, fill = employment_status == "Employed/self-employed (full or part time)"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Employment",
    y = "Mean Annual Visits \n",
    title = "Mean Annual Visits 2013-2019") +
  coord_flip()
```


```{r}
employment_demographics %>%
  group_by(employment_status) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = employment_status, y = mean_exp_per_visit, fill = employment_status == "Employed/self-employed (full or part time)"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Employment",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019") +
  coord_flip()
```

```{r}
employment_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(employment_status, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = reorder(employment_status, difference_exp_per_visit_pct), y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Employment Status",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Diff, 2019 vs. 2013-2018 Avg.") +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
  
```

### Car Access

Highest Mean Spend Per Visit Over Period: People with access to a car spent more per visit on average.
Mean Spend Per Visit (2013-2018) vs. 2019: Both Increased.

Conclusion: Although people with access to a car spend more per visit, spend per visit amongst those without access to a car increased by more than those with a car. Highlights potential growth in this areas and particuarly related to transport.

```{r}
car_demographics %>%
  group_by(access_to_car) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = access_to_car, y = mean_exp_per_visit, fill = access_to_car == "Access to car (1+)"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Car Access",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019",
    subtitle = "By Car Access")
```
```{r}
car_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(access_to_car, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = access_to_car, y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Access To Car",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```

### Social Grade

AB	Higher & intermediate managerial, administrative, professional occupations.
C1	Supervisory, clerical & junior managerial, administrative, professional occupations.
C2	Skilled manual occupations.
DE	Semi-skilled & unskilled manual occupations, Unemployed and lowest grade occupations.

```{r}
social_demographics %>%
  group_by(social_grade) %>% 
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = reorder(social_grade, mean_exp_per_visit), y = mean_exp_per_visit, fill = social_grade == "AB"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Social Gradee",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit 2013-2019") +
  coord_flip()
```

```{r}
social_demographics %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(social_grade, is_2019) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = reorder(social_grade, difference_exp_per_visit_pct), y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Social Grade",
    y = "% Difference \n",
    title = "Expenditure Per Visit % Difference, 2019 vs. 2013-2018 Avg.") +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```


## Activities

```{r}
activities %>%
  group_by(tourism_activity) %>%
  summarise(mean_exp = mean(expenditure)) %>% 
  ggplot() +
  geom_col(aes(x = tourism_activity, y = mean_exp,
               fill = tourism_activity == "Eating Out"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Activity",
    y = "Mean Annual Spend \n",
    title = "Mean Annual Spend, 2013-2019") +
  coord_flip()
```


```{r}
activities %>%
  group_by(tourism_activity) %>%
  summarise(mean_visits = mean(visits)) %>% 
  ggplot() +
  geom_col(aes(x = tourism_activity, y = mean_visits,
               fill = tourism_activity == "Visited friends or family for leisure"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Activity",
    y = "Mean Annual Visits \n",
    title = "Mean Annual Visits, 2013-2019") +
  coord_flip()
```


```{r}
activities %>%
  group_by(tourism_activity) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  ggplot() +
  geom_col(aes(x = tourism_activity, y = mean_exp_per_visit,
               fill = tourism_activity == "Shopping for Non-Regular Purchases"),
           show.legend = FALSE) +
  scale_fill_manual(values = c("FALSE" = "grey40",
                               "TRUE" = "forestgreen")) +
  labs(
    x = "\n Activity",
    y = "Mean Expenditure per Visit \n",
    title = "Mean Expenditure per Visit, 2013-2019") +
  coord_flip()
```

```{r}
activities %>% 
  mutate(is_2019 = if_else(year == 2019, "2019", "2013-2018")) %>% 
  group_by(tourism_activity, is_2019) %>%
  arrange(tourism_activity) %>%
  summarise(mean_exp_per_visit = mean(exp_per_visit)) %>% 
  mutate(difference_exp_per_visit = mean_exp_per_visit - lag(mean_exp_per_visit),
         difference_exp_per_visit_pct = (mean_exp_per_visit - lag(mean_exp_per_visit)) / lag(mean_exp_per_visit) * 100,
         difference_exp_per_visit_label = if_else(difference_exp_per_visit > 0, "Increased", "Decreased")) %>% 
  filter(difference_exp_per_visit != is.na(difference_exp_per_visit)) %>% 
  ggplot(aes(x = reorder(tourism_activity, difference_exp_per_visit_pct), y = difference_exp_per_visit_pct)) +
  geom_col(aes(fill = difference_exp_per_visit_label), show.legend = FALSE) +
  # geom_text(aes(label = str_c(floor(difference_exp_per_visit_pct), "%"), vjust = -0.5)) +
  scale_fill_manual(values = c("Increased" = "forestgreen",
                               "Decreased" = "firebrick")) +
  labs(
    x = "\n Activity",
    y = "% Difference \n",
    title = "Mean Expenditure per Visit, 2019 vs. 2013-2018 Avg.") +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(scale = 1))
```


## Domestic & International Visitors

### Domestic vs. International

```{r}
domestic_2017_2019_visits <- regional_domestic_tourism %>% 
  filter(date_code == "2017-2019",
         region_of_residence == "All of GB") %>% 
  select(visits)
  

international_2017_2019_visits <- international_visits %>%
  select(-c(quarter, age, sample)) %>%
  filter(year %in% c(2017, 2018, 2019)) %>% 
  summarise(mean_visits = mean(visits)) %>% 
  select(mean_visits)

tibble(a = c("Domestic", "International"),
       b = c(domestic_2017_2019_visits$visits, international_2017_2019_visits$mean_visits)) %>% 
  ggplot() +
  geom_col(aes(x = a, y = b)) +
  labs(
    x = "",
    y = "Visits \n",
    title = "Domestic vs. International Visits",
    subtitle = "2017-2019")
```

```{r}
domestic_2017_2019_spend <- regional_domestic_tourism %>% 
  filter(date_code == "2017-2019",
         region_of_residence == "All of GB") %>% 
  select(expenditure)
  
international_2017_2019_spend <- international_visits %>%
  select(-c(quarter, age, sample)) %>%
  filter(year %in% c(2017, 2018, 2019)) %>% 
  summarise(total_visits = sum(visits),
            total_spend = sum(spend),
            exp_per_visit = total_spend / total_visits) %>% 
  select(total_spend)

tibble(a = c("Domestic", "International"),
       b = c(domestic_2017_2019_spend$expenditure, international_2017_2019_spend$total_spend)) %>% 
  ggplot() +
  geom_col(aes(x = a, y = b)) +
  labs(
    x = "",
    y = "Expenditure \n",
    title = "Domestic vs. International Expenditure",
    subtitle = "2017-2019")
```

### International

#### Summary

```{r}
ips_2002_2019 %>%
  summarise(cor(spend, visits))
```

```{r}
model_ips <- lm(formula = spend ~ visits, data = ips_2002_2019)
summary(model_ips)
```

```{r}
autoplot(model_ips)
```

```{r}
ips_2002_2019 %>%
  add_predictions(model_ips) %>%
  add_residuals(model_ips) %>% 
  ggplot(aes(x = visits, y = spend)) +
  geom_point() +
  geom_line(aes(y = pred), col = "red") +
  annotate("text", x = 1675, y = 2500, label = "spend ~ visits") +
  annotate("text", x = 1930, y = 2300, label = "b1 = 0.81800 / p-value = 2.46e-08") +
  annotate("text", x = 2170, y = 2100, label = "R-Squared = 0.864 / Residual Standard Error: 195.2") +
  labs(
    x = "Visits (Million)",
    y = "Expenditure (£Million) \n",
    title = "Scotland: International Visits vs. Spend",
    subtitle = "2002-2019")
```

#### By Country

```{r}
international_visits %>% 
  select(-c(quarter, age, sample)) %>%
  filter(country %in% c("USA", "Germany", "Australia", "France", "China"),
         year %in% c(2013, 2014, 2015, 2016, 2017, 
                                2018, 2019)) %>% 
  group_by(year, country) %>% 
  summarise(total_spend = sum(spend)) %>% 
  ggplot(aes(x = year, y = total_spend, colour = country)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2013, 2014, 2015, 2016, 2017, 
                                2018, 2019)) +
  labs(x = "\n Year",
       y = "Expenditure (Million) \n",
       title = "Expenditure by Country",
       subtitle = "Top 5 Countries per Total Expenditure")
```

```{r}
international_visits %>% 
  select(-c(quarter, age, sample)) %>%
  filter(country %in% c("USA", "Germany", "France", "Netherlands", "Australia"),
         year %in% c(2013, 2014, 2015, 2016, 2017, 
                                2018, 2019)) %>% 
  group_by(year, country) %>% 
  summarise(total_visits = sum(visits)) %>% 
  ggplot(aes(x = year, y = total_visits, colour = country)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2013, 2014, 2015, 2016, 2017, 
                                2018, 2019)) +
  labs(x = "\n Year",
       y = "Visits (Million) \n",
       title = "Visits by Country",
       subtitle = "Top 5 Countries per Visits")
```


#### USA

```{r}
ips_2002_2019_usa %>%
  summarise(cor(spend, visits))
```

```{r}
model_ips_usa <- lm(formula = spend ~ visits, data = ips_2002_2019_usa)
summary(model_ips_usa)
```

Model: spend ~ visits

Interpretation: ~83% of the variation in expenditure can be explained by the number of visits. 

Question: USA visits increased by 11.5789% between 2018 and 2019 to 636 Million. If this percentage increase in visits was replicated in 2020 (709.642m), what would our model predict for expenditure?

Answer: If USA visits were increased as above, the model would predict expenditure of ~£723m (Low Estimate ~£655m, High Estimate ~£791m)

As calculated below.

Step 1.
outcome = b0 + b1 * 1st Predictor

Step 2.
expenditure = b0(intercept) + b1(coefficient) * 1st Predictor

Step 3.
expenditure = b0(intercept) + b1(coefficient) * `visits`

Step 4.
expenditure = -195.9631 + 1.2953 * `709.642`

Step 5.
expenditure = 723.2287 (Low Estimate 655.3287, High Estimate 791.1287)


```{r}

predict_at <- data.frame(visits = c(709.642))

# get predicted heights at those sample_weights
predict(model_ips_usa, newdata = predict_at)
```

```{r}
723.2287  + c(-67.9, 67.9)
```


```{r}
ips_2002_2019_usa %>%
  add_predictions(model_ips_usa) %>%
  add_residuals(model_ips_usa) %>% 
  ggplot(aes(x = visits, y = spend)) +
  geom_point() +
  geom_line(aes(y = pred), col = "red") +
  labs(
    x = "Visits (Million)",
    y = "Expenditure (£Million) \n",
    title = "Scotland: USA Visits vs. Spend",
    subtitle = "2002-2019")
```

```{r}
autoplot(model_ips_usa)
```


```{r}
library(broom)
library(factoextra)
library(sf)
```

```{r}
usa_visit_spend_region %>%
  group_by(region) %>% 
  summarise(mean_spend = mean(spend),
            mean_visits = mean(visits)) %>% 
  ggplot(aes(x = mean_visits, y = mean_spend, colour = region)) +
  geom_point()
```


```{r}
usa_visit_spend_region %>% 
  ggplot(aes(x = year, y = visits, colour = region, group = region)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019))
```

```{r}
usa_visit_spend_region %>% 
  ggplot(aes(x = year, y = spend, colour = region, group = region)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019))
```

```{r}
library(leaflet)
library(leafpop)
```


```{r}

pal <- colorNumeric(
  palette = "Reds",
  domain = usa_visit_spend_region$visits)

usa_visit_spend_region %>%
  filter(year == 2019) %>% 
  leaflet() %>%
  addTiles() %>% 
  addCircleMarkers(lng = ~long.x,
                   lat = ~lat.x,
                   color = ~pal(visits)) %>% 
                   # popup = ~paste(location, "<br> Spend:", spend, "<br> Visits:", visits)) %>% 
  addLegend(position = "bottomright", pal = geo_palette, values = ~visits, opacity = 2, title = "Visits") %>% 
  addControl(position = "topright", html = title)
```




----------------------------------------------------------------

















----------------------------------------------------------------


```{r}
scotland_regions <- st_read(dsn = "geo/", # Data Source Name/Path
                          layer = "SG_ScottishPoliceDivisions_2019")
```

```{r}
glimpse(scotland_regions)
```

```{r}
scotland_regions$PDivName
```

```{r}
ggplot(scotland_regions) +
  geom_sf(fill = "antiquewhite")
```












-----------







```{r}
activities_summary <- activities %>%
  group_by(tourism_activity) %>% 
  summarise(mean_expenditure = mean(Expenditure),
            mean_visits = mean(Visits),
            exp_per_visit = mean_expenditure / mean_visits) %>% 
  arrange(desc(exp_per_visit))
```

```{r}
activities_clust <- activities %>%
  group_by(tourism_activity) %>% 
  summarise(total_expenditure = sum(Expenditure),
            total_visits = sum(Visits)) %>% 
  select(total_expenditure, total_visits)
```



```{r}
min_k <- 1
max_k <- 5

k_clusters <- tibble(k = min_k:max_k) %>% 
  mutate(kclust = map(k, ~ kmeans(activities_clust, # Create K-means cluster beteen 1-25 clusters.
                                  centers = .x,
                                  nstart = 25)),
         tidied = map(kclust, tidy), # Tidies `kclust`
         glanced = map(kclust, glance), # Uses tidied to create a glance
         augmented = map(kclust, augment, activities_summary)) # Adds labels

# Unnest `glanced` to view `tot.withinss`
clusterings <- k_clusters %>% 
  unnest(glanced)

clusterings
```

```{r}
clusterings %>% 
  ggplot(aes(x = k, y = tot.withinss)) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = seq(1, 25, 1))
```

```{r}
fviz_nbclust(activities_clust,
             kmeans,
             method = "wss", #within sum of squares
             nstart = 25)
```

```{r}
fviz_nbclust(activities_clust,
             kmeans,
             method = "silhouette",
             nstart = 25)
```


```{r}
clusterings %>% 
  unnest(augmented) %>% # Unnest augmented created in step 5.1
  filter(k == 2) %>% # Set number of clusters
  ggplot(aes(x = total_visits, y = total_expenditure, colour = .cluster)) +
  geom_point()
```

```{r}
clusterings %>% 
  unnest(augmented) %>% # Unnest augmented created in step 5.1
  filter(k == 2) %>% 
  group_by(.cluster)
```


-----------------------------------------------------------