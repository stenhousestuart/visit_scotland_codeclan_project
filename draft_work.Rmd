---
title: "R Notebook"
output: html_notebook
---

```{r}
library(broom)
library(factoextra)
library(sf)
```

```{r}
usa_visit_spend_region %>%
  group_by(region) %>% 
  summarise(mean_spend = mean(spend),
            mean_visits = mean(visits)) %>% 
  ggplot(aes(x = mean_visits, y = mean_spend, colour = region)) +
  geom_point()
```


```{r}
usa_visit_spend_region %>% 
  ggplot(aes(x = year, y = visits, colour = region, group = region)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019))
```

```{r}
usa_visit_spend_region %>% 
  ggplot(aes(x = year, y = spend, colour = region, group = region)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019))
```

```{r}
library(leaflet)
library(leafpop)
```


```{r}

pal <- colorNumeric(
  palette = "Reds",
  domain = usa_visit_spend_region$visits)

usa_visit_spend_region %>%
  filter(year == 2019) %>% 
  leaflet() %>%
  addTiles() %>% 
  addCircleMarkers(lng = ~long.x,
                   lat = ~lat.x,
                   color = ~pal(visits)) %>% 
                   # popup = ~paste(location, "<br> Spend:", spend, "<br> Visits:", visits)) %>% 
  addLegend(position = "bottomright", pal = geo_palette, values = ~visits, opacity = 2, title = "Visits") %>% 
  addControl(position = "topright", html = title)
```




----------------------------------------------------------------

















----------------------------------------------------------------


```{r}
scotland_regions <- st_read(dsn = "geo/", # Data Source Name/Path
                          layer = "SG_ScottishPoliceDivisions_2019")
```

```{r}
glimpse(scotland_regions)
```

```{r}
scotland_regions$PDivName
```

```{r}
ggplot(scotland_regions) +
  geom_sf(fill = "antiquewhite")
```












-----------







```{r}
activities_summary <- activities %>%
  group_by(tourism_activity) %>% 
  summarise(mean_expenditure = mean(Expenditure),
            mean_visits = mean(Visits),
            exp_per_visit = mean_expenditure / mean_visits) %>% 
  arrange(desc(exp_per_visit))
```

```{r}
activities_clust <- activities %>%
  group_by(tourism_activity) %>% 
  summarise(total_expenditure = sum(Expenditure),
            total_visits = sum(Visits)) %>% 
  select(total_expenditure, total_visits)
```



```{r}
min_k <- 1
max_k <- 5

k_clusters <- tibble(k = min_k:max_k) %>% 
  mutate(kclust = map(k, ~ kmeans(activities_clust, # Create K-means cluster beteen 1-25 clusters.
                                  centers = .x,
                                  nstart = 25)),
         tidied = map(kclust, tidy), # Tidies `kclust`
         glanced = map(kclust, glance), # Uses tidied to create a glance
         augmented = map(kclust, augment, activities_summary)) # Adds labels

# Unnest `glanced` to view `tot.withinss`
clusterings <- k_clusters %>% 
  unnest(glanced)

clusterings
```

```{r}
clusterings %>% 
  ggplot(aes(x = k, y = tot.withinss)) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = seq(1, 25, 1))
```

```{r}
fviz_nbclust(activities_clust,
             kmeans,
             method = "wss", #within sum of squares
             nstart = 25)
```

```{r}
fviz_nbclust(activities_clust,
             kmeans,
             method = "silhouette",
             nstart = 25)
```


```{r}
clusterings %>% 
  unnest(augmented) %>% # Unnest augmented created in step 5.1
  filter(k == 2) %>% # Set number of clusters
  ggplot(aes(x = total_visits, y = total_expenditure, colour = .cluster)) +
  geom_point()
```

```{r}
clusterings %>% 
  unnest(augmented) %>% # Unnest augmented created in step 5.1
  filter(k == 2) %>% 
  group_by(.cluster)
```


-----------------------------------------------------------


